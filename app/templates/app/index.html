{% extends 'app/base.html' %}


{% block head %}
	<title>Home</title>
{% endblock %}
{% block content %}
	<div class="container-fluid" style="margin-top:120px">
		<div class="row">
			<div class="col-sm-6">
				<div class="form-group">
					<label for="id_task">Task:</label>
					<input type="text" id="id_task" class="form-control">
					<p id="error_task" class="text-danger ml-1 small"></p>
				</div>
			</div>
			<div class="col-sm-6">
				<div class="form-group">
					<label for="id_date_completed">Completed By:</label>
					<div class="row">
						<div class="col-6">
							<input min="2020-6-11" type="date" id="id_date" class="form-control">
						</div>
						<div class="col-6">
							<input type="time" id = 'id_time' class="form-control">
						</div>
					</div>
					<p id="error_date_completed" class="text-danger ml-1 small"></p>
				</div>
			</div>
		</div>
		<div style = 'max-width:400px;margin: 5px auto;'>
			<button id="add" class="btn btn-block btn-dark">Add</button>
		</div>
	</div>
	<div class="container mt-5 mb-5">
		<!-- Tasks In Progress -->
		<div class="card border-primary">
			<div class="card-header bg-primary text-light">
				Tasks In Progress <span class="badge badge-light">0</span>
			</div>
			<div class="card-body">
				{% if tasks_in_progress %}
					<ul class="list-group">
						{% for task in tasks_in_progress %}
							<li class="list-group-item">{{ task }}</li>
						{% endfor %}
					</ul>
				{% else %}
					<p class="text-center text-muted lead">No Tasks In Progress</p>
				{% endif %}
			</div>
		</div>
		<!-- Completed Tasks -->
		<div class="card mt-3 border-success">
			<div class="card-header bg-success text-light">
				Completed Tasks <span class="badge badge-light">0</span>
			</div>
			<div class="card-body">
				{% if completed_tasks %}
					<ul class="list-group">
						{% for task in completed_tasks %}
							<li class="list-group-item">{{ task }}</li>
						{% endfor %}
					</ul>
				{% else %}
					<p class="text-center text-muted lead">No Completed Tasks</p>
				{% endif %}
			</div>
		</div>
		<!-- Uncompleted Tasks -->
		<div class="card mt-3 border-danger">
			<div class="card-header bg-danger text-light">
				Uncompleted Tasks <span class="badge badge-light">0</span>
			</div>
			<div class="card-body">
				{% if uncompleted_tasks %}
					<ul class="list-group">
						{% for task in uncompleted_tasks %}
							<li class="list-group-item">{{ task }}</li>
						{% endfor %}
					</ul>
				{% else %}
					<p class="text-center text-muted lead">No Uncompleted Task</p>
				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}
{% block javascript %}
	<script>
		// Function that adds a task to the users To-Do list
		let addTask = () => {
			$('#add').click(function(){
				let task = $('#id_task');
				let date = $('#id_date');
				let time = $('#id_time');
				let taskError = $('#error_task');
				let dateCompletedError = $('#error_date_completed')
				if(task.val() && date.val() && time.val()){
					// Make an ajax request
					$.ajax({
						url: "{% url 'app:add_task' %}",
						data: {
							'task': task.val(),
							'date': date.val(),
							'time': time.val(),
						},
						dataType: 'json',
						success: function(data){
							console.log("Good");
							// Clear the errors and fields
							task.val('');
							date.val('');
							time.val('');
							taskError.text('');
							dateCompletedError.text('');
						}
					});
				}
				else if(!task.val() && (date.val() || time.val())){
					taskError.text('You must specify the task you want to complete.');
					dateCompletedError.text('');
				}
				else if(task.val() && (!date.val() || !time.val())){
					dateCompletedError.text('You must specify the date and time you want to complete the task');
					taskError.text('');
				}
				else{
					taskError.text('You must specify the task you want to complete.');
					dateCompletedError.text('You must specify the date and time you want to complete the task');
				}
			});
		} 
		addTask() // Invoke function
	</script>
{% endblock %}